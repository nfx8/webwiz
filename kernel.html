<html>
  <head>
    <title>Kernel Density Estimation</title>
    <script type="text/javascript" src="http://vis.stanford.edu/protovis/protovis-r3.2.js"></script>
    <script type="text/javascript" src="kde.js"></script>
    <script type="text/javascript" src="faithful.js"></script>
    <style type="text/css">

    body {
      margin: 0;
    }

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">

/* Sizing and scales. */
var w          = document.body.clientWidth - 40,
    h          = document.body.clientHeight - 25,
    x          = pv.Scale.linear(30, 110).range(0, w),
    y          = pv.Scale.linear(0, 0.1).range(0, h),
    bandwidths = [1, 7, 20];

/* The root panel. */
var vis = new pv.Panel()
    .width(w)
    .height(h)
    .bottom(20)
    .left(30)
    .right(10)
    .top(5);

/* X-axis ticks. */
vis.add(pv.Rule)
    .data(x.ticks())
    .left(x)
    .strokeStyle("#eee")
  .add(pv.Rule)
    .bottom(-5)
    .height(5)
    .strokeStyle("#000")
  .anchor("bottom").add(pv.Label)
    .text(x.tickFormat);

/* Y-axis ticks. */
vis.add(pv.Rule)
    .data(y.ticks(5))
    .bottom(y)
    .strokeStyle("#eee")
  .anchor("left").add(pv.Label)
    .text(y.tickFormat);

/* Histogram */
vis.add(pv.Bar)
    .data(pv.histogram(faithful).frequency(false).bins(x.ticks(60)))
    .bottom(0)
    .left(function(d) x(d.x))
    .width(function(d) x(d.dx + 30))
    .height(function(d) y(d.y))
    .fillStyle("#aaa")
    .strokeStyle("rgba(255, 255, 255, .2)")
    .lineWidth(1);

/* Kernel density estimates */
var panel = vis.add(pv.Panel)
    .data(bandwidths);

var line = panel.add(pv.Line)
    .data(function(h) kde(faithful).scale(h).points(pv.range(30, 110, 0.1)))
    .left(function(d) x(d.x))
    .bottom(function(d) y(d.y));

panel.add(pv.Dot)
     .shape("square")
     .lineWidth(0)
     .fillStyle(function() line.strokeStyle())
     .top(function () this.parent.index * 12 + 10)
     .left(10)
   .anchor("right").add(pv.Label)
     .text(function (h) "h = " + h);

vis.render();

    </script>
  </body>
</html>